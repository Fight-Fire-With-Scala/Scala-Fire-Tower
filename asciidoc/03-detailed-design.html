<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Model</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="paragraph">
<p>In questa sezione, si mostrano le scelte di design più critiche circa l&#8217;organizzazione della struttura del sistema e dei suoi componenti.</p>
</div>
<div class="sect1">
<h2 id="_model">Model</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_gameboard">GameBoard</h3>
<div id="game-board-class-diagram" class="imageblock">
<div class="content">
<img src="diag-634c72c9e8d9c81e704fc0ee0fa0581e.svg" alt="diag 634c72c9e8d9c81e704fc0ee0fa0581e" width="1128" height="1055">
</div>
<div class="title">Figure 1. Diagramma delle classi che mostra le classi della GameBoard.</div>
</div>
<div class="paragraph">
<p>La <code>GameBoard</code> è la parte cruciale del model dell&#8217;applicazione.
Parlerò delle classi principali che lo compongono e del loro ruolo.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GameBoard</code>: Contiene un riferimento alla <code>Board</code>, che a sua volta contiene la <code>Grid</code> e la direzione del
vento, insieme al mazzo di carte (<code>Deck</code>) e ai due giocatori. C&#8217;è anche un riferimento al <code>PlayerManager</code>,
che consente di gestire il turno dei giocatori.
Infine, contiene il numero del turno e la fase di gioco corrente.
Offre la possibilità di ottenere i giocatori, di gestirli (cambio turno), di determinare se qualche giocatore
ha vinto sull&#8217;altro, e di poter risolvere gli effetti di gioco (<code>IGameEffect</code>) tramite il metodo solveEffect racchiuso
nel Trait <code>GameBoardManager</code>.</p>
</li>
<li>
<p><code>Board</code>: Rappresenta la griglia di gioco e la direzione del vento. Offre metodi per verificare se una torre è in
fiamme e per generare configurazioni standard e di fine gioco della griglia.</p>
</li>
<li>
<p><code>Deck</code>: Gestisce il mazzo di carte, inclusa la miscelazione, la pesca di carte standard e speciali,
e la rigenerazione del mazzo.</p>
</li>
<li>
<p><code>Player</code>: Rappresenta un giocatore nel gioco, con il suo nome, le mosse effettuate, le carte in mano,
una carta extra opzionale e le posizioni delle torri.</p>
</li>
<li>
<p><code>PlayerToggle</code>: Gestisce il turno dei giocatori. Ad esempio per cambiare il turno verrà usato il metodo toggle.</p>
</li>
<li>
<p><code>GamePhase</code>: Enumera le diverse fasi del gioco, come la fase del vento, la fase di ridistribuzione delle carte,
la fase di gioco delle carte standard, ecc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Componente fondamentale della <code>GameBoard</code> è la <code>Grid</code>, che gestisce la griglia di gioco.</p>
</div>
<div id="grid-class-diagram" class="imageblock">
<div class="content">
<img src="diag-64914d9e177514d29bac7353e8e56ce9.svg" alt="diag 64914d9e177514d29bac7353e8e56ce9" width="1570" height="641">
</div>
<div class="title">Figure 2. Diagramma delle classi che mostra le classi della Grid.</div>
</div>
<div class="paragraph">
<p>La <code>Grid</code> è composta da tre parti fondamentali:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Il Trait, che definisce l&#8217;interfaccia base per la griglia. Contiene i metodi per ottenere e impostare le celle
e i token.</p>
</li>
<li>
<p>L&#8217;Object, che implementa il Trait <code>Grid</code> e offre metodi per creare le istanze, come quella vuota, standard o di fine gioco.
Contiene anche la costante per la dimensione della griglia. Le istanze sono definite in <code>GridDefinitions</code>, che contiene
le configurazioni.</p>
</li>
<li>
<p>La classe <code>BasicGrid</code> è l&#8217;implementazione concreta del Trait <code>Grid</code> e ne definisce i metodi.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Allo scopo di essere creata la <code>Grid</code> utilizza la classe <code>GridBuilder</code> che permette di costruire la griglia in modo incrementale.</p>
</div>
<div class="paragraph">
<p>Attraverso i suoi metodi setNextCell e nextRow (poi utilizzati tramite alias + e -) è possibile procedere alla creazione.
Nell&#8217;Object <code>GridBuilder</code> vengono forniti dei metodi di configurazione e un DSL per facilitarne la costruzione.
Il DSL tiene conto dei simboli T,F,E per rappresentare i vari tipi di cella (Torre, Foresta e Eternal Fire).</p>
</div>
<div class="paragraph">
<p>La <code>Grid</code> contiene anche la classe <code>TowerPositionManager</code>, che permette di ottenere le posizioni delle celle torri basate sulla loro
posizione. Questo è utile per determinare se una torre è in fiamme e per effettuare i calcoli per il Bot.</p>
</div>
<div class="paragraph">
<p>Le Enumerazioni <code>Cell</code> e <code>ConcreteToken</code> definiscono rispettivamente :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Cell</code>: Le celle che possono essere posizionate sulla griglia, come la torre, la foresta e il fuoco eterno.</p>
</li>
<li>
<p><code>ConcreteToken</code>: I token che possono essere posizionati su una cella, come tagliafuoco, fuoco, acqua, reforest e empty.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>I Token vengono definiti in un Trait con un identificativo ed un colore (per la rappresentazione grafica), ma poi utilizzano
la enumerazione che ne estende il Trait per definire i token concreti.</p>
</div>
<div class="paragraph">
<p>Come anticipato in precedenza, svolge il ruolo di gestione degli effetti di gioco il Trait
<code>GameBoardManager</code>.
È infatti responsabile di risolvere i vari tipi di effetti di gioco, che sono:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PhaseEffect</code></p>
</li>
<li>
<p><code>HandEffect</code></p>
</li>
<li>
<p><code>PatternEffect</code></p>
</li>
<li>
<p><code>GameBoardEffectSolver</code></p>
</li>
<li>
<p><code>WindUpdateEffect</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Molti di questi solver vengono gestiti in altre parti dell&#8217;applicazione, come per la fase,
per la hand, per il pattern e per il wind update.</p>
</div>
<div class="paragraph">
<p>Una volta risolto l&#8217;effetto, il <code>GameBoardManager</code> ritorna la <code>GameBoard</code> aggiornata.</p>
</div>
</div>
<div class="sect2">
<h3 id="_player">Player</h3>
<div id="player-class-diagram" class="imageblock">
<div class="content">
<img src="diag-517492cb69a7da4009e6098ae9e961ed.svg" alt="diag 517492cb69a7da4009e6098ae9e961ed" width="1394" height="974">
</div>
<div class="title">Figure 3. Diagramma delle classi che mostra le classi del Player.</div>
</div>
<div class="paragraph">
<p>Per quanto riguarda la modellazione dei giocatori, visto la possibilità di avere un giocatore umano e un giocatore bot, si è deciso di modellare il giocatore come un Trait <strong>Player</strong> che contiene i metodi comuni tra i due tipi di giocatori.
Nello specifico il Trait Player contiene le seguenti informazioni:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: Il nome del giocatore</p>
</li>
<li>
<p><strong>moves</strong>: La lista delle mosse effettuate dal giocatore</p>
</li>
<li>
<p><strong>hand</strong>: La lista delle carte in mano al giocatore</p>
</li>
<li>
<p><strong>extraCard</strong>: Una carta extra che il giocatore può avere in mano</p>
</li>
<li>
<p><strong>towerPositions</strong>: Un set di posizioni delle proprie torri</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Inoltre sono presenti una serie di Option per memorizzare le ultime azioni effettuate dal giocatore.</p>
</div>
<div class="paragraph">
<p>Il Trait inoltre implementa i metodi comuni tra i due tipi di giocatori come:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>drawCardFromDeck</strong>: Metodo che permette di pescare una carta dal mazzo ed inserirla nell&#8217;apposito slot della mano del giocatore popolando la hand in caso di carte normali o l&#8217;extraCard in caso di carte speciali</p>
</li>
<li>
<p><strong>playCard</strong>: Metodo che permette di giocare una carta dalla mano del giocatore e restituisce il giocatore aggiornato e la carta giocata</p>
</li>
<li>
<p><strong>logMove</strong>: Metodo che permette di loggare una mossa effettuata dal giocatore</p>
</li>
<li>
<p><strong>discardCards</strong>: Metodo che permette di scartare una o più carte dalla mano del giocatore</p>
</li>
<li>
<p><strong>updatePlayer</strong> di aggiornare le informazioni del giocatore in base alle mosse effettuate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il Trait Player è esteso da tre classi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Person</strong>: Rappresenta un giocatore umano che non presenta particolari comportamenti aggiuntivi</p>
</li>
<li>
<p><strong>Bot</strong> e <strong>ThinkingPlayer</strong>: Che vanno a rappresentare il giocatore bot.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_bot">Bot</h3>
<div class="paragraph">
<p>Il Bot oltre a contenere le informazioni del giocatore, contiene un riferimento al <strong>BotBehaviour</strong> che rappresenta il comportamento del bot e un riferimento all'<strong>BotSubject</strong> che rappresenta l&#8217;observable del bot utilizzato per interagire con i componenti esterni simulando le azioni gestite tramite gli handler grafici.
Inoltre per reagire ai cambi stato del gioco, viene usato il metodo <strong>think</strong> che permette al bot di effettuare le azioni necessarie per il proprio turno.</p>
</div>
<div class="paragraph">
<p>Tramite il trait <strong>ThinkingPlayer</strong> vengono implementati i metodi per la gestione delle fasi del turno e delle azioni da compiere in base alla fase del turno.
Più nello specifico vengono implementati i metodi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>thinkForWindPhase</strong>: Metodo che permette al bot di piazzare un token fuoco sulla griglia in base alla direzione del vento.</p>
</li>
<li>
<p><strong>thinkForWaitingPhase</strong>: Metodo che permette al bot di decidere se giocare una carta o scartare e pescare</p>
</li>
<li>
<p><strong>thinkForRedrawCardPhase</strong>: Metodo che permette al bot di scartare e pescare fino a 5 carte dalla propria mano</p>
</li>
<li>
<p><strong>thinkForPlayStandardCardPhase</strong>: Metodo che permette al bot di giocare una carta dalla propria mano</p>
</li>
<li>
<p><strong>thinkForDecisionPhase</strong>: Metodo che permette al bot di decidere terminare il turno o giocare una carta speciale</p>
</li>
<li>
<p><strong>thinkForPlaySpecialCardPhase</strong>: Metodo che permette al bot di giocare una carta speciale dalla propria mano</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A supporto dei metodi di think, è stato implementato il trait <strong>IMakeDecision</strong> che contiene i metodi per filtrare le carte in base alla decisione e per verificare la presenza di token fuoco o fire break sulla griglia.</p>
</div>
<div class="paragraph">
<p>Ogni metodo di think presenta un&#8217;implementazione specifica per il bot che permette di gestire le azioni in modo automatico.
Nel dettaglio:</p>
</div>
</div>
<div class="sect2">
<h3 id="_thinkforwindphase">thinkForWindPhase</h3>
<div class="paragraph">
<p>Per permettere il piazzamento di un token fuoco sulla griglia in base alla direzione del vento, vengono designate come torri target le due torri avversarie e modellata la direzione del vento riproducendo una carta.
Viene poi lasciata la computazione della posizione del token fuoco alla teoria prolog LogicSolverManager.</p>
</div>
</div>
<div class="sect2">
<h3 id="_thinkforwaitingphase">thinkForWaitingPhase</h3>
<div class="paragraph">
<p>Per definire se passare alla fase di PlayStandardCard o RedrawCard, vine utilizzata la teoria Prolog AttackDefenseTheory per determinare se passare in fase di attacco o difesa, in base alla decisione presa vengono analizzate le carte presenti in mano e scelte le azioni da compiere.
Se non sono presenti carte che possono essere giocate, il bot passa alla fase di RedrawCard.</p>
</div>
</div>
<div class="sect2">
<h3 id="_thinkforredrawcardphase">thinkForRedrawCardPhase</h3>
<div class="paragraph">
<p>Per scartare e pescare fino a 5 carte dalla propria mano, il bot scarta le carte che non sono utili per la fase di gioco corrente e pesca fino a 5 carte.</p>
</div>
</div>
<div class="sect2">
<h3 id="_thinkforplaystandardcardphase">thinkForPlayStandardCardPhase</h3>
<div class="paragraph">
<p>Per giocare una carta dalla propria mano, vengono filtrate le carte in base alla decisione presa in fase di Waiting e scomposte in effetti singoli visto che alcune carte possono avere sia effetti difensivi che offensivi.
Una volta ottenuta la mappa dei relativi id carta ed effetto, viene utilizzata la teoria Prolog LogicSolverManager per determinare la carta da giocare e la posizione in cui giocarla.</p>
</div>
</div>
<div class="sect2">
<h3 id="_thinkfordecisionphase">thinkForDecisionPhase</h3>
<div class="paragraph">
<p>Per decidere se terminare il turno o giocare una carta speciale, il bot verifica la presenza token fuoco nelle porpoise torri.</p>
</div>
</div>
<div class="sect2">
<h3 id="_thinkforplayspecialcardphase">thinkForPlaySpecialCardPhase</h3>
<div class="paragraph">
<p>Se presente la carta speciale nella mano del bot viene calcolata la posizione in cui piazzarla tramite la teoria Prolog LogicSolverManager.</p>
</div>
<div class="paragraph">
<p>Ogni metodo di think chiama a sua volta <strong>onUpdateGamePhaseRequest</strong> per notificare la view del cambio di fase e <strong>handleMoveAndApplyEffect</strong> per applicare gli effetti delle mosse.</p>
</div>
</div>
<div class="sect2">
<h3 id="_effetti">Effetti</h3>
<div class="paragraph">
<p>Di seguito si discute la rappresentazione e la gestione degli effetti sulla gameboard.
Il sistema si basa sui concetti di effetto e risolutore. Gli effetti esprimono i cambiamenti che sono applicati alla gameboard e incapsulano i parametri necessari per effettuarlo.
I risolutori permettono di risolvere gli effetti e di comporre le modifiche al campo di gioco tramite catene di funzione higher order.
Questo approccio permette di ottenere un sistema flessibile, espandibile e modulare, che facilita l&#8217;espansione o la modifica degli effetti senza cambiare la struttura principale del gioco.</p>
</div>
<div class="paragraph">
<p>In <a href="#game-effect-class-diagram">Diagramma delle classi che rappresenta i principali effetti di gioco.</a> sono mostrati i principali effetti di gioco, ovvero:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>HandEffect</strong>: include i cambiamenti alla mano del giocatore, relativi allo scartare, pescare o giocare carte.</p>
</li>
<li>
<p><strong>PatternEffect</strong>: include i cambiamenti alla griglia, relativi al piazzamento di pattern di token, come fuoco e tagliafuoco.</p>
</li>
<li>
<p><strong>MoveEffect</strong>: include la registrazione delle mosse dei giocatori, relative ad esempio alla scelta di carte da giocare o ripescare.</p>
</li>
<li>
<p><strong>PhaseEffect</strong>: consente la gestione dei cambiamenti della fase di gioco.</p>
</li>
<li>
<p><strong>GameBoardEffect</strong>: rappresenta una sorta di effetto "terminale", ovvero si trova al termine di una catena di funzioni e rappresenta il risultato della mossa di un giocatore. Incapsula la gameboard aggiornata.</p>
</li>
</ul>
</div>
<div id="game-effect-class-diagram" class="imageblock">
<div class="content">
<img src="game-effect.svg" alt="game effect" width="681" height="162">
</div>
<div class="title">Figure 4. Diagramma delle classi che rappresenta i principali effetti di gioco.</div>
</div>
<div class="paragraph">
<p>In <a href="#solver-types-class-diagram">Diagramma delle classi che rappresenta i risolutori di logica.</a> sono mostrati i principali risolutori, ovvero:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ISolveGameEffect</strong>: è un&#8217;interfaccia generica che riceve in input un effetto e lo traduce in un altro effetto.</p>
</li>
<li>
<p><strong>GameEffectSolver</strong>: rappresenta un&#8217;istanza concreta di risolutore che è utilizzata nell&#8217;applicazione come intermediario tra altri risolutori o come terminale di una catena di funzioni nel caso restituisca un <code>GameBoardEffect</code>.</p>
</li>
<li>
<p><strong>LogicEffectSolver</strong>: è l&#8217;istanza di un risolutore specializzata nella restituzione di effetti logici, ovvero degli effetti che saranno poi usati per il calcolo dei pattern.</p>
</li>
<li>
<p><strong>PatternEffectSolver</strong>: è l&#8217;istanza di un risolutore specializzata nella restituzione del risultato del calcolo dei pattern.</p>
</li>
</ul>
</div>
<div id="solver-types-class-diagram" class="imageblock">
<div class="content">
<img src="solver-types.svg" alt="solver types" width="1026" height="185">
</div>
<div class="title">Figure 5. Diagramma delle classi che rappresenta i risolutori di logica.</div>
</div>
</div>
<div class="sect2">
<h3 id="_carte">Carte</h3>
<div class="paragraph">
<p>Di seguito si discute la rappresentazione e la gestione delle carte e dei relativi effetti sul campo di gioco.</p>
</div>
<div class="paragraph">
<p>Grazie al sistema degli effetti e dei risolutori è stato possibile facilitare l&#8217;espansione o la modifica degli effetti senza cambiare la struttura principale del gioco.</p>
</div>
<div class="paragraph">
<p>Come si può osservare in <a href="#card-types-class-diagram">Figura 6</a>, gli effetti delle carte sono stati suddivise in due categorie: standard e speciali. Esistono cinque tipi di effetti, uno per ogni tipologia di carta del gioco:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Secchio</strong>: effetto speciale che fa riferimento alle uniche carte che permettono di rimuovere dei token fuoco che si trovano nell&#8217;area di una torre;</p>
</li>
<li>
<p><strong>Tagliafuoco</strong>: effetto standard che permette di aggiungere o rimuovere dei tagliafuoco dal campo di gioco. I tagliafuoco impediscono di piazzare dei token fuoco nella posizione in cui si trovano.</p>
</li>
<li>
<p><strong>Fuoco</strong>: effetto standard utilizzato per piazzare dei token fuoco.</p>
</li>
<li>
<p><strong>Acqua</strong>: effetto standard utilizzato per rimuovere i token fuoco che non si trovano nei confini delle torri.</p>
</li>
<li>
<p><strong>Vento</strong>: effetto standard che permette di modificare la direzione del vento o di piazzare un token fuoco.</p>
</li>
</ul>
</div>
<div id="card-types-class-diagram" class="imageblock">
<div class="content">
<img src="solvers.svg" alt="solvers" width="653" height="407">
</div>
<div class="title">Figura 6. Diagramma delle classi che rappresenta i risolutori di logica.</div>
</div>
<div class="paragraph">
<p>A ciascuna tipologia sono associate delle proprietà specifiche tramite appositi tratti. In particolare le carte standard possono essere scartate, al contrario delle carte speciali. Inoltre le carte speciali possono essere giocate in aggiunta ad altre azioni del turno.</p>
</div>
<div class="paragraph">
<p>Esistono due tipologie di effetti che possono essere associate agli effetti di una carta tramite un risolutore: quelli che richiedono di scegliere tra quelli possibili un pattern da applicare, che estendono <code>PatternLogicEffect</code>, e quelli che richiedono di effettuare scelte di altro genere, che estendono <code>IGameChoiceEffect</code>. La gerarchia completa è mostrata in <a href="#effect-types-class-diagram">Figura 7</a>. Si osserva che <code>IGameChoiceEffect</code> è utilizzato per rappresentare gli effetti di cambiamento della direzione del vento, ovvero <code>WindUpdateEffect</code>.</p>
</div>
<div id="effect-types-class-diagram" class="imageblock">
<div class="content">
<img src="solvers.svg" alt="solvers" width="318" height="273">
</div>
<div class="title">Figura 7. Diagramma delle classi che rappresenta i risolutori di logica.</div>
</div>
<div class="paragraph">
<p>In <a href="#pattern-types">Figura 8</a> sono mostrati i possibili pattern riportati dalle carte, che indicano come sono applicati i token sulla griglia.</p>
</div>
<div id="pattern-types" class="imageblock text-center">
<div class="content">
<img src="img.png" alt="img">
</div>
<div class="title">Figura 8. Rappresentazione delle tipologie di pattern della griglia.</div>
</div>
<div class="paragraph">
<p>Gli effetti di applicazione dei pattern delle carte possono essere suddivisi in due categorie principali: effetti difensivi ed effetti offensivi.
Come si osserva in <a href="#logic-effect-types-class-diagram">Figura 9</a>, entrambe le tipologie di effetti estendono <code>ILogicComputation</code>, dato che incapsulano i parametri richiesti per il calcolo in Prolog.
Ciascuna <code>ILogicEffect</code> può essere associato a uno o più di queste computazioni, a seconda della complessità dell&#8217;effetto logico associato a una carta.</p>
</div>
<div id="logic-effect-types-class-diagram" class="imageblock">
<div class="content">
<img src="solvers.svg" alt="solvers" width="421" height="162">
</div>
<div class="title">Figura 9. Diagramma delle classi che rappresenta i risolutori di logica.</div>
</div>
<div class="paragraph">
<p>Ad esempio in <a href="#fire-effect-listing">Listato 1</a> è riportata la definizione delle carte fuoco.
Si osserva l&#8217;utilizzo di una enumerazione per associare al tipo di effetto il relativo codice, impiegato in fase di lettura del file delle stringhe in inglese per popolare il titolo e la descrizione di ciascuna carta.</p>
</div>
<div class="paragraph">
<p>Ciascuna effetto di una carta è poi associato a un ulteriore effetto che definisce i parametri necessari per la sua risoluzione logica, tramite un metodo che funge da risolutore, di tipo <code>LogicEffectSolver</code>.</p>
</div>
<div id="fire-effect-listing" class="listingblock">
<div class="title">Listato 1. Frammento di codice relativo alla dichiarazione dei tipi di carta fuoco e dei relativi effetti logici.</div>
<div class="content">
<pre class="highlight"><code class="language-scala" data-lang="scala">enum FireEffect(override val effectId: Int) extends IStandardCardEffect:
  case Explosion extends FireEffect(1)
  case Flare extends FireEffect(2)
  case BurningSnag extends FireEffect(3)
  case Ember extends FireEffect(4)

object FireEffect:
  val fireEffectSolver: LogicEffectSolver[FireEffect] = LogicEffectSolver:
    case Explosion =&gt;
      OffensiveEffect(
        VeryLargePattern(Map("a" -&gt; Fire, "b" -&gt; Firebreak)),
        Rule("explosion")
      )
    case Flare       =&gt; OffensiveEffect(MediumPattern(Map("a" -&gt; Fire)), Rule("fire"))
    case BurningSnag =&gt; OffensiveEffect(LargePattern(Map("a" -&gt; Fire)), Rule("fire"))
    case Ember =&gt;
      List(
        OffensiveEffect(
          VerySmallPattern(Map("a" -&gt; Water)),
          Rule("ember_first_phase")
        ),
        OffensiveEffect(
          VerySmallPattern(Map("a" -&gt; Fire)),
          Rule("ember_second_phase")
        )
      )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Per effettuare l&#8217;associazione tra l&#8217;effetto di una carta e i parametri necessari per il calcolo dei possibili punti di applicazione del relativo pattern si utilizza una la given mostrata in <a href="#given-logic-card-effect">Listato 2</a>.</p>
</div>
<div id="given-logic-card-effect" class="listingblock">
<div class="title">Listato 2. Frammento di codice relativo alla</div>
<div class="content">
<pre class="highlight"><code class="language-scala" data-lang="scala">  given Conversion[ICardEffect, ILogicEffect] = convert(_)

  def convert(effect: ICardEffect): ILogicEffect = effect match
    case e: IStandardCardEffect =&gt;
      e match
        case e: FireEffect      =&gt; FireEffect.fireEffectSolver.solve(e)
        case e: FirebreakEffect =&gt; FirebreakEffect.fireBreakEffectSolver.solve(e)
        case e: WaterEffect     =&gt; WaterEffect.waterEffectSolver.solve(e)
        case e: WindEffect      =&gt; WindEffect.windEffectSolver.solve(e)
        case _                  =&gt; ILogicEffect()
    case e: ISpecialCardEffect =&gt;
      e match
        case BucketEffect =&gt; BucketEffect.bucketEffect
        case _            =&gt; ILogicEffect()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_turno">Turno</h3>
<div class="sect3">
<h4 id="_divisione_del_turno_da_regolamento_ufficiale">Divisione del turno da regolamento ufficiale</h4>
<div class="paragraph">
<p>Una partita è composta da una serie di turni, a sua volta il turno viene suddiviso in due parti fondamentali ed una facoltativa che sono:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Il vento diffonde le fiamme: <em>Scegli uno spazio vuoto il cui bordo sia adiacente, nella direzione in cui il vento sta soffiando, ad
una Gemma Fuoco o alla Fiamma Eterna e posiziona una Gemma Fuoco su di esso. Due spazi
sono adiacenti se si toccano su uno dei 4 lati, mai in diagonale</em>.</p>
</li>
<li>
<p>Esegui un’Azione dalla Torre (solo una delle due seguenti azioni): <em>Gioca una Carta dalla tua mano ed esegui l’azione indicata su di essa . Una volta che l’Azione è finita, metti la Carta nella pila degli
scarti e pesca una nuova Carta dal mazzo.
Oppure scarta e pesca fino a 5 Carte dalla tua mano. Dovresti sempre avere cinque Carte in mano
una volta che hai finito il tuo turno. Nota: I secchi non fanno parte della tua mano. </em></p>
<div class="ulist">
<ul>
<li>
<p>Azione Addizionale Facoltativa: <em>In qualsiasi momento durante il tuo turno puoi giocare il tuo
Secchio in aggiunta al resto del tuo turno </em></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_modellazione_della_divisione_del_turno">Modellazione della divisione del turno</h4>
<div id="phases-turn" class="imageblock text-center">
<div class="content">
<img src="assets/images/TurnStates.svg" alt="TurnStates">
</div>
<div class="title">Figura 10. Diagramma degli stati delle fasi di un turno</div>
</div>
<div class="paragraph">
<p>Per la gestione delle fasi del turno ed una migliore integrazione con il modello di gioco, si è deciso di modellare il turno come una macchina a stati finiti.
Nello specifico il turno è composto da 8 stati:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>WindPhase</strong> (Stato iniziale) : Fase iniziale del turno che permette il piazzamento di un token fuoco sulla griglia in base alla direzione del vento</p>
</li>
<li>
<p><strong>WaitingPhase</strong>: Fase di stallo successiva alla fase iniziale, in attesa che il giocatore scelga se giocare una carta o scartare e pescare</p>
</li>
<li>
<p><strong>PlayStandardCardPhase</strong>: Fase in cui il giocatore gioca una carta dalla propria mano</p>
</li>
<li>
<p><strong>RedrawCardPhase</strong>: Fase in cui il giocatore scarta e pesca fino a 5 carte dalla propria mano</p>
</li>
<li>
<p><strong>DecisionPhase</strong>: Fase prettamente logica utilizzata per determinare il passaggio di fase successivo basandosi sulla presenza o non di carte speciali nella mano del giocatore</p>
</li>
<li>
<p><strong>PlaySpecialCardPhase</strong>: Fase in cui il giocatore gioca una carta speciale dalla propria mano (Bucket card)</p>
</li>
<li>
<p><strong>EndTurnPhase</strong>: Fase finale del turno nella quale viene preparato il turno successivo</p>
</li>
<li>
<p><strong>EndGamePhase</strong> (Stato finale): Fase finale della partita</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La transizione da uno stato all&#8217;altro è determinata dalle azioni compiute dal giocatore gestite tramite handler specifici che vengono attivati e disattivati a livello di View in base allo stato attuale. A supporto degli handler è stato implementato il Trait <strong>PhaseManager</strong> che permette di automatizzare le azioni a livello di model per le transizioni di stato non dipendenti dal giocatore.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_prolog">Prolog</h3>
<div class="paragraph">
<p>L&#8217;impiego della programmazione logica ha permesso di esprimere dichiarativamente regole e vincoli
per il calcolo dei possibili punti di applicazione dei pattern delle carte sulla griglia e per
consentire al bot di prendere decisioni in base allo stato della board e alla propria mano.</p>
</div>
<div class="paragraph">
<p>La scelta di un approccio risolutivo basato sulla programmazione logica ha permesso di esprimere in modo
conciso e facilmente componibile ed estendibile le regole di gioco e la logica del bot.</p>
</div>
<div class="paragraph">
<p>La <code>GridTheory</code> è la classe che rappresenta la logica per la costruzione
di una teoria Prolog basata sulla griglia di gioco nella sua interezza.</p>
</div>
<div class="paragraph">
<p>Essa raggruppa vari tipi di iteratori, come quello delle celle, dei pattern, delle direzioni,
dei delta delle direzioni, e infine li combina tutti in uno unico per poterlo passare a Prolog.</p>
</div>
<div class="paragraph">
<p>Essa permette di rappresentare la situazione di gioco nella sua interezza allo scopo
di compiere vari calcolo, come quello della PatternComputation o delle decisioni del Bot.</p>
</div>
<div id="grid-theory-prolog" class="listingblock">
<div class="title">Listato 3. Frammento di codice Prolog che mostra come è costruita la teoria relativa alla griglia di gioco.</div>
<div class="content">
<pre class="highlight"><code class="language-prolog" data-lang="prolog">cell((0,0),t).
cell((0,1),t).
cell((0,2),w).
cell((0,3),w).

cell((1,0),t).
cell((1,1),w).
cell((1,2),w).
cell((1,3),w).

cell((2,0),w).
cell((2,1),w).
cell((2,2),ef).
cell((2,3),ef).

cell((3,0),w).
cell((3,1),w).
cell((3,2),w).
cell((3,3),w).

token((0,2),f).

numRows(4).
numCols(4).

pattern((0,0),f,1).
pattern((0,1),f,1).

directions([north,south,east,west], 1).
deltas([(-1,0),(1,0),(0,1),(0,-1)], 1).</code></pre>
</div>
</div>
<div class="paragraph">
<p>Qui sopra è raffigurato l&#8217;esempio della GridTheory in un caso ridotto, in cui la griglia sarebbe
grande 4x4, con due pattern e un token piazzato.</p>
</div>
<div class="sect3">
<h4 id="_decisione_del_bot_attaccodifesa">Decisione del Bot Attacco/Difesa</h4>
<div class="paragraph">
<p>La parte di Prolog relativa alla decisione di Attacco/Difesa è stata implementata
per determinare quale sia la strategia migliore per il bot da adottare in base alla situazione
della griglia di gioco.
A questo scopo, trova la torre più vicina al fuoco, utilizzando la distanza di Manhattan.</p>
</div>
<div class="paragraph">
<p>La teoria Prolog che viene costruita su Scala è la <code>AttackDefenseTheory</code> e contiene i seguenti elementi:
- la griglia di gioco
- il set delle posizioni torre del giocatore
- il set delle posizioni torre dell&#8217;avversario
- il <code>botBehaviour</code>, cioè un oggetto che rappresenta il comportamento del bot tramite il <code>Bias</code></p>
</div>
<div class="paragraph">
<p>Allo scopo di ottenere le celle della griglia di gioco, viene utilizzato il Trait <code>GridCellsProvider</code>.
La teoria ottiene gli iteratori delle celle di gioco e gli iteratori delle posizioni delle torri, combinandoli poi in un iteratore unico.
Dopo di chè viene aggiunta anche la variabile di bias e i solver necessari al calcolo.</p>
</div>
<div class="paragraph">
<p>L&#8217;algoritmo è integrato con Scala per delineare poi la strategia.
Definirò ora le parti cruciali del codice Prolog che consentono di eseguire questo calcolo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>closest_tower_to_fire/1</code>: torva la torre più vicina al fuoco calcolando le distanze per
le proprie torri e per le torri avversarie. A questo scopo viene utilizzata min_distance_to_fire/3.
Allo scopo di influenzare la decisione strategica del bot viene introdotto un <strong>Bias</strong> che permette di dare più peso alle torri avversarie
rispetto a quelle proprie o viceversa. Questo bias viene
aggiunto alla distanza delle torri del giocatore e influenza la sua decisione.</p>
</li>
<li>
<p><code>min_distance_to_fire/3</code>: trova la distanza minima tra un insieme di posizioni delle torri e qualsiasi cella fuoco, restituendo
la posizione della torre più vicina.
Le distanze vengono calcolate tramite la funzione manhattan_distance/2.
Allo scopo di trovare le distanze minime vengono utilizzate le funzioni min_member che data una tupla
restituiscono le distanze minime in una lista di tuple.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La <code>closest_tower_to_fire</code> ritorna la torre più vicina, che poi Scala, determinandone il proprietario, utilizzerà per decidere la strategia da adottare.</p>
</div>
</div>
<div class="sect3">
<h4 id="_availablepatterns_e_patterntoplay">AvailablePatterns e PatternToPlay</h4>
<div class="paragraph">
<p>Per fornire al bot le informazioni necessarie a decidere che carta giocare e in che posizione specifica
della griglia applicare il pattern è stata implementata la generazione procedurale di una serie di
teorie che codificano lo stato della board.</p>
</div>
<div class="paragraph">
<p>partendo dalla teoria di calcolo dei pattern disponibili per una carta
integrandola con la posizione delle torri da bersagliare e teorie di utility che permettono di eseguire una
ricorsione tra torri e pattern per definire la posizione migliore su cui piazzare il pattern.</p>
</div>
<div class="paragraph">
<p>La teoria è formata dai seguenti componenti:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>GridTheory</strong>: che ricostruisce la griglia di gioco in prolog</p>
</li>
<li>
<p><strong>tower_position</strong>: che contiene le posizioni delle torri</p>
</li>
<li>
<p><strong>ManhattanSolver</strong>: che permette di calcolare la distanza di manatthan tra due punti</p>
</li>
<li>
<p><strong>ConcatListTheory</strong>: che permette di concatenare liste in modo ricorsivo</p>
</li>
<li>
<p><strong>AllCardResultTheory</strong>: che permette di realizzare una teoria prolog dinamica componendo i risultati di tutti i pattern disponibili per ogni carta passata in una lista unica</p>
</li>
<li>
<p><strong>CardChoserSolver</strong>: che permette di effettuare una ricorsione su torri e pattern per definire quale sia il piu vicino alla torre e quindi il migliore da giocare</p>
</li>
<li>
<p><strong>CardSolver</strong> e <strong>BaseSolver</strong>: che permettono di risolvere gli effetti delle carte in base alla griglia di gioco e ottenere tutti i pattern disponibili per una carta</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La composizione di questa teoria in modo dinamico in base alle carte passate permette di ottenere una teoria prolog che si adatta alla situazione di gioco e permette di ottenere una soluzione ottimale per il bot.</p>
</div>
<div class="paragraph">
<p>A seguito verrà descritto il codice prolog che permette di risolvere la scelta del pattern da giocare.</p>
</div>
<div class="sect4">
<h5 id="_cardsolver_e_basesolver">CardSolver e BaseSolver</h5>
<div class="paragraph">
<p>Permettono la risoluzione degli effetti delle carte in base alla griglia di gioco e di ottenere tutti i pattern disponibili per una carta.
BaseSolver implementa una serie di metodi prolog che permettono di avere i pattern disponibili basandosi sulla griglia e i token presenti ricreando le forme geometriche dei pattern presenti sulle carte originali poi composti da ogni effetto specifico.</p>
</div>
<div class="paragraph">
<p>Un esempio di risoluzione degli effetti delle carte è il seguente:
Presupponendo di dover risolvere una carta di tipo <strong>SmokeJumper</strong>, il predicato <strong>smoke_jumper/3</strong> permette di ottenere tutti i pattern disponibili per la carta.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_smoke_jumper3"><code>smoke_jumper/3</code></h3>
<div class="paragraph">
<p>Return all the available application points of the given pattern that are computed from the set of points that are fire tokens on woods or tower cells, checking the central point of the 3x3 pattern, computed with the offset (-1, -1).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-prolog" data-lang="prolog">smoke_jumper(R, CardId, EffectId) :- match_if_both_token_and_cell(Coords, [w, t], [f]), compute_pattern_with_offset((-1, -1), Coords, R, _, CardId, EffectId).</code></pre>
</div>
</div>
<div class="paragraph">
<p>Questa regola identifica i punti di applicazione disponibili per un pattern che rappresenta Smoke Jumper. Il pattern viene applicato se il punto centrale del pattern 3x3, calcolato con l&#8217;offset (-1, -1), è un token di fuoco su celle di tipo bosco o torre.</p>
</div>
<div class="paragraph">
<p><strong>CardSolver</strong>, <strong>BaseSolver</strong> e <strong>GridTheory</strong> sono quindi utilizzati combinati come unica teoria per il calcolo dei pattern disponibili per ogni carta in fase di piazzamento, permettendo quindi un highlight delle possibili posizioni sulla griglia di gioco.</p>
</div>
<div class="sect3">
<h4 id="_cardchosersolver">CardChoserSolver</h4>

</div>
<div class="sect3">
<h4 id="_main1"><code>main/1</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-prolog" data-lang="prolog">main(R) :-
    get_all_cards_result(AllResults),
    findall(TowerPos, tower_position(TowerPos), TowerPositions),
    find_closest_to_all_towers(AllResults, TowerPositions, R).</code></pre>
</div>
</div>
<div class="paragraph">
<p>Identifica il pattern piu vicino alla torre.</p>
</div>
</div>
<div class="sect3">
<h4 id="_find_closest_to_all_towers3"><code>find_closest_to_all_towers/3</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-prolog" data-lang="prolog">find_closest_to_all_towers([],_,([],_)):- !.

find_closest_to_all_towers(AllResults, [Tower], Closest):-
    find_closest(AllResults, Tower, Closest, ClosestDist, MinDistTmp).

find_closest_to_all_towers(AllResults, [Tower1, Tower2 | RestTowers], Closest):-
    find_closest(AllResults, Tower1, Closest1, ClosestDist1, MinDistTmp),
    find_closest(AllResults, Tower2, Closest2, ClosestDist2, MinDistTmp),
    (ClosestDist1 &lt; ClosestDist2 -&gt;
        find_closest_to_all_towers(AllResults, [Tower1 | RestTowers], Closest),
        Closest = Closest1
    ;
        find_closest_to_all_towers(AllResults, [Tower2 | RestTowers], Closest),
        Closest = Closest2
    ).</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esegue una ricorsione per ogni torre identificando il pattern e la distanza minima da ogni torre.</p>
</div>
</div>
<div class="sect3">
<h4 id="_find_closest5"><code>find_closest/5</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-prolog" data-lang="prolog">find_closest([(Coords, CardId)], TowerPos, (Coords, CardId),  MinDistTmp, MinDistTmp) :- !.

find_closest([(Coords1, CardId1), (Coords2, CardId2) | Rest], TowerPos, Closest, ClosestDist, MinDistTmp) :-
    find_min_distance(Coords1, TowerPos, MinDist1),
    find_min_distance(Coords2, TowerPos, MinDist2),
    (MinDist1 &lt; MinDist2 -&gt;
        find_closest([(Coords1, CardId1) | Rest], TowerPos, Closest, ClosestDist, MinDist1)
    ;
        find_closest([(Coords2, CardId2) | Rest], TowerPos, Closest, ClosestDist, MinDist2)
    ).</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_find_min_distance3"><code>find_min_distance/3</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-prolog" data-lang="prolog">find_min_distance([(X,Y,T)], TowerPos, MinDist) :-
    manhattan_distance((X,Y), TowerPos, MinDist).

find_min_distance([(X1,Y1,T1), (X2,Y2,T2) | Rest], TowerPos, MinDist) :-
    manhattan_distance((X1,Y1), TowerPos, Dist1),
    manhattan_distance((X2,Y2), TowerPos, Dist2),
    (Dist1 &lt; Dist2 -&gt;
        find_min_distance([(X1,Y1,T1) | Rest], TowerPos, MinDist)
    ;
        find_min_distance([(X2,Y2,T2) | Rest], TowerPos, MinDist)
    ).</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esplora tutta la lista di pattern e per ognuno esplora tutte le posizioni contenute nel pattern per identificare quale sia il piu vicino alla torre definita.</p>
</div>
<div class="paragraph">
<p>Per far si che  <strong>get_all_cards_result(AllResults)</strong> potesse essere eseguito per un numero variabile di carte è stata implementata la classe <strong>AllCardResultTheory</strong> che permette di concatenare i risultati di tutti i pattern disponibili per ogni carta realizzando una lista unica tramite <strong>ConcatListTheory</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_concat_lists2"><code>concat_lists/2</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-prolog" data-lang="prolog">%Base case
concat_lists([], []).

%Recursive case
concat_lists([List | Rest], R):-
    concat_lists(Rest, RestResult),
    append(List, RestResult, R).</code></pre>
</div>
</div>
<div class="paragraph">
<p>Il predicato <code>concat_lists/2</code> concatena una lista di liste in una singola lista.
cosi da poter aver un unico risultato per tutte le carte passate.</p>
</div>
</div>
<div class="sect3">
<h4 id="_esempio_di_composizione_della_teoria_dinamica_per_2_carte">Esempio di composizione della teoria dinamica per 2 carte</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-prolog" data-lang="prolog">get_all_cards_result(R) :-
    findall((_2392719, 44), smoke_jumper(_2392719,44,0), R44),
    findall((_2392720, 41), water(_2392720,41,0), R41),
    concat_lists([R44, R41], R).</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_view">View</h2>
<div class="sectionbody">
<div id="game" class="imageblock text-center">
<div class="content">
<img src="start-game.png" alt="start game">
</div>
<div class="title">Figura 11. Immagine del gioco</div>
</div>
<div class="sect2">
<h3 id="_inizializzazione_e_gamecomponent">Inizializzazione e GameComponent</h3>
<div class="paragraph">
<p>Il <code>GameComponent</code> rappresenta la radice della gerarchia di componenti JavaFX che forma la GUI mostrata all&#8217;utente durante le fasi di gioco.</p>
</div>
<div id="game-component-class-diagram" class="imageblock">
<div class="content">
<img src="game-component.svg" alt="game component" width="871" height="545">
</div>
<div class="title">Figura 12. Diagramma delle classi dei componenti che formano la GUI durante le fasi di gioco.</div>
</div>
<div class="paragraph">
<p>In <a href="#game-component-class-diagram">Figura 12</a> è mostrata l&#8217;organizzazione dei componenti di gioco. Si osserva che i tre principali componenti sono la barra laterale, la griglia e la mano del giocatore.</p>
</div>
<div class="paragraph">
<p>La barra laterale è composta da diversi sotto-componenti, ovvero:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>GameInfoComponent</strong>: riporta le informazioni sul numero del turno, sul giocatore corrente e sullo stato di gioco.</p>
</li>
<li>
<p><strong>DeckComponent</strong>: permette di avviare, confermare o cancellare la procedura di ripescaggio delle carte, utilizzando l' InternalViewSubject per comunicare con le api di HandComponent.</p>
</li>
<li>
<p><strong>WindRoseComponent</strong>: mostra la direzione del vento corrente e permette di cambiarla se si gioca una carta vento.</p>
</li>
<li>
<p><strong>DiceComponent</strong>: permette di aggiornare in modo pseudocasuale la direzione del vento.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_griglia_di_gioco">Griglia di gioco</h3>
<div id="grid-component-class-diagram" class="imageblock">
<div class="content">
<img src="diag-1c455859d6e654e59debead414252148.svg" alt="diag 1c455859d6e654e59debead414252148" width="1351" height="1064">
</div>
<div class="title">Figura 13. Diagramma delle classi dei componenti utilizzati per la griglia</div>
</div>
<div class="paragraph">
<p>I componenti fondamentali della parte di view che gestisce la griglia sono:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GridComponent</code>: è il componente principale che gestisce la griglia di gioco. In particolare, ne gestisce
l&#8217;inizializzazione tramite <code>GridInitializer</code> che crea l&#8217;insieme delle celle <code>GridSquare</code> associandole agli handler
gestiti da <code>GridEventHandler</code>. Inoltre, si occupa di aggiornare la griglia in base alla fase di gioco e alle posizioni
attuali delle torri.</p>
</li>
<li>
<p><code>GridEventHandler</code>: è il componente che coordina gli eventi di click e hover sulla griglia. Utilizza altre due classi:
<code>GridClickHandler</code> e <code>GridHoverHandler</code> per gestire rispettivamente gli eventi di click e hover, a cui passa tramite given
la squareMap, cioè la mappa delle celle della griglia, e gridState, che mantiene lo stato della griglia.</p>
</li>
<li>
<p><code>GridClickHandler</code>: si focalizza sulla gestione dei click sulla griglia, eseguendo azioni specifiche in base alla fase
di gioco e alla posizione cliccata.</p>
</li>
<li>
<p><code>GridHoverHandler</code>: si occupa della gestione degli eventi di hover sulla griglia, aggiornando lo stato della griglia in
relazione alle celle in hover.</p>
</li>
<li>
<p><code>GridSquare</code>: rappresenta una singola cella della griglia di gioco. Gestisce gli eventi di hover e click su di esse, permettendo
anche la sua disabilitazione/attivazione tramite il tratto <code>ICanBeDisabled</code>.</p>
</li>
<li>
<p><code>GridState</code>: mantiene lo stato corrente della griglia, permettendo di adattarsi a tutte le situazioni richieste.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_mano_del_giocatore_e_carte">Mano del giocatore e Carte</h3>
<div class="sect3">
<h4 id="_handcomponent">HandComponent</h4>
<div class="paragraph">
<p>La view relativa alla mano viene composta passando come parametro alla classe una Lista di CardComponent, ciò permette un' integrazione dinamica dei componenti grafici che verranno inizializzati in fase di initialize dell' FXML.</p>
</div>
<div class="paragraph">
<p>HandComponent mette a disposizione delle api per la gestione della mano e graficamente e logicamente.
Si possono identificare i metodi per gestire al completo la procedura di rimozione delle carte dalla mano per eseguire l&#8217;azione di scarto:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>initDiscardProcedure</p>
</li>
<li>
<p>cancelDiscardProcedure</p>
</li>
<li>
<p>toggleCardInDiscardList</p>
</li>
<li>
<p>discardCards</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>e per giocare una carta:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cardToPlay_</p>
</li>
<li>
<p>confirmCardPlay</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Inoltre tramite il metodo <strong>updateHand</strong> permette di settare una carta in ogni cardComponent al suo interno.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cardcomponent">CardComponent</h4>
<div id="hand-card-diagram" class="imageblock">
<div class="content">
<img src="diag-66b73591d18f1b9b68c32b38d23ce249.svg" alt="diag 66b73591d18f1b9b68c32b38d23ce249" width="999" height="803">
</div>
<div class="title">Figura 14. Diagramma delle classi dei componenti delle carte</div>
</div>
<div class="paragraph">
<p>CardComponent è la classe che rappresenta graficamente una carta all&#8217;interno della mano del giocatore.
Una volta inserita in HandComponent viene aggiornata in modo dinamico modificando la carta che va a rappresentare tramite il metodo di setCard.
Ogni cardComponent tiene traccia dell' id della carta, del titolo e della descrizione della carta stessa.
E modifica dinamicamente il proprio handler in base al tipo di carta e la fase di gioco, a questo scopo estende il Trait ICanSwitchHandler, che permette di definire quali handler attivare in base alla fase di gioco.</p>
</div>
<div class="paragraph">
<p>Inoltre viene gestito il suo stato di highlight tramite il CardHighlightManager, che permette di definire lo stato di highlight della carta e di modificarlo in base alla fase di gioco.</p>
</div>
</div>
<div class="sect3">
<h4 id="_menucomponent">MenuComponent</h4>
<div id="menu" class="imageblock text-center">
<div class="content">
<img src="start-screen.png" alt="start screen">
</div>
<div class="title">Figura 15. Immagine del menu</div>
</div>
<div class="paragraph">
<p>Il MenuComponent è un componente della View che gestisca l&#8217;interfaccia utente
del menu di gioco.</p>
</div>
<div class="paragraph">
<p>È responsabile di inizializzare e gestire i vari elementi dell&#8217;interfaccia utente.
Raccoglie i dati dell&#8217;utente mandando poi un messaggio di inizializzazione al tabellone di gioco
tramite l&#8217;observable collegato alla View.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_controller">Controller</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_subscriber">Subscriber</h3>
<div class="sect3">
<h4 id="_botsubscriber">BotSubscriber</h4>
<div class="paragraph">
<p>Il BotSubscriber è registrato agli aggiornamenti del Bot e in base ai suoi aggiornamenti aggiorna il modello.
Quando riceve un messaggio aggiorna la fase di gioco e permette all&#8217;applicazione di mantenersi aggiornata coi suoi
aggiornamenti.</p>
</div>
</div>
<div class="sect3">
<h4 id="_internalviewsubscriber">InternalViewSubscriber</h4>
<div class="paragraph">
<p>Permette di ricevere i messaggi interni di view e agire di conseguenza ocn il relativo controller specifico.
è risultato necessario integrare la view con un subscriber interno per permettere comunicazioni interne tra le varie componenti.
Nello specifico viene principalmente utilizzato per le comunicazioni tra Deck e Hand per gestire la procedura di scarto delle carte, e per la comunicazione tra Card ed Hand per gestire la procedura di giocata delle carte.</p>
</div>
<div class="paragraph">
<p>A supporto del subscriber sono stati realizzati i trait DiscardCardController e PlayCardController.</p>
</div>
</div>
<div class="sect3">
<h4 id="_modelsubscriber">ModelSubscriber</h4>
<div class="paragraph">
<p>Il ModelSubscriber permette di  ricevere messaggi da parte del model e agire di conseguenza sulla parte di View.</p>
</div>
<div class="paragraph">
<p>Nello specifico viene utilizzato per notificare l&#8217;inizio della partita e permettere quindi la realizzazione della view iniziale di gioco,
i successivi refresh grafici in base allo specifico refreshType e confermare alla view che la carta è stata giocata correttamente.</p>
</div>
</div>
<div class="sect3">
<h4 id="_viewsubscriber">ViewSubscriber</h4>
<div class="paragraph">
<p>Il View Subscriber funge da interfaccia del Model e consente di gestire i messaggi ricevuti dalla View. Esistono diversi gruppi di messaggi che possono essere inviati dalla View nelle diverse fasi di gioco.
Di seguito saranno mostrati i protocolli di scambio di messaggi di alcune di queste fasi tramite dei diagrammi di sequenza.</p>
</div>
<div class="paragraph">
<p>In <a href="#start-game-sequence-diagram">Figura 16</a> è mostrato il protocollo utilizzato durante l&#8217;avvio della partita.</p>
</div>
<div id="start-game-sequence-diagram" class="imageblock">
<div class="content">
<img src="start-game-protocol.svg" alt="start game protocol" width="261" height="74">
</div>
<div class="title">Figura 16. Diagramma di sequenza che mostra lo scambio di messaggi durante l&#8217;avvio del gioco.</div>
</div>
<div class="paragraph">
<p>In <a href="#wind-phase-sequence-diagram">Figura 17</a> è mostrato il protocollo utilizzato durante la <code>WindPhase</code>.</p>
</div>
<div id="wind-phase-sequence-diagram" class="imageblock">
<div class="content">
<img src="wind-phase-protocol.svg" alt="wind phase protocol" width="241" height="74">
</div>
<div class="title">Figura 17. Diagramma di sequenza che mostra lo scambio di messaggi durante la <code>WindPhase</code>.</div>
</div>
<div class="paragraph">
<p>In <a href="#waiting-phase-sequence-diagram">Figura 18</a> è mostrato il protocollo utilizzato durante la <code>WaitingPhase</code>.</p>
</div>
<div id="waiting-phase-sequence-diagram" class="imageblock">
<div class="content">
<img src="card.svg" alt="card" width="255" height="74">
</div>
<div class="title">Figura 18. Diagramma di sequenza che mostra lo scambio di messaggi durante la <code>WaitingPhase</code>.</div>
</div>
<div class="paragraph">
<p>In <a href="#play-standard-sequence-diagram">Figura 19</a> è mostrato il protocollo utilizzato durante la <code>PlayStandardCardPhase</code>.</p>
</div>
<div id="play-standard-sequence-diagram" class="imageblock">
<div class="content">
<img src="card.svg" alt="card" width="282" height="74">
</div>
<div class="title">Figura 19. Diagramma di sequenza che mostra lo scambio di messaggi durante la <code>PlayStandardCardPhase</code>.</div>
</div>
</div>
<div class="sect3">
<h4 id="_refreshcontroller_e_activationcontroller">RefreshController e ActivationController</h4>
<div class="paragraph">
<p>Il <code>RefreshController</code> e l'`ActivationController` sono due componenti chiave del sistema che gestiscono
l&#8217;aggiornamento e quindi l&#8217;attivazione/disattivazioni delle varie componenti grafiche in base alla fase di gioco
e agli eventi che si verificano durante la partita.</p>
</div>
<div class="paragraph">
<p>In particolare, il RefreshController è responsabile di aggiornare la vista in base a diversi tipi di
aggiornamenti (RefreshType). Attraverso il metodo updateAccordingToRefreshType, si decide quale parte grafica
necessita di un aggiornamento.</p>
</div>
<div class="paragraph">
<p>Allo scopo di modificare le parti di View in una maniera veloce e unica per tutti i componenti grafici
è stato creato l&#8217;ActivationController, il RefreshController lo estende, in modo da poterlo utilizzare.
Esso gestisce l&#8217;attivazione e disattivazione delle varie componenti di View in base
alla fase di gioco. E' quindi il responsabile di aggiornare lo stato visivo del gioco, e di garantire che
le componenti rilevanti siano attive o non attive durante tutte le fasi di gioco.
Sfrutta tutti i componenti che implementano il tratto ICanBeDisabled permettendo un cambio del loro stato.
Ad esempio, solo quando è possibile il piazzamento di un pattern la griglia è attiva.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-09-18 23:50:54 +0200
</div>
</div>
</body>
</html>